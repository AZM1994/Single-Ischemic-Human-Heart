args = (commandArgs(TRUE));
pathfname = args[1];

#pathfname = "a"


cal_mapd <- function(ncnr){
	ncnr_1<-c(0,ncnr)
	n<-length(ncnr)
	b <- abs(log2(ncnr) - log2(ncnr_1[1:n]))
	return (median(b[2:n]))
}



dat <- read.table(paste(pathfname,sep=""), header = T, sep="\t")
#cnr <- sort(log2(dat$cn.ratio))
#cnr <- log2(dat$cn.ratio)

chromlist <- c(1:22, "X", "Y")

cont <- c()
cont <- rbind(cont, c("chrom", "MAPD"))
for (chrom in unique(dat$chrom)){
	idx = which(dat$chrom==chrom)
	mapd <- cal_mapd(dat[idx,]$cn.ratio)
	#cat (mapd, "\n")
	cont <- rbind(cont, c(chromlist[chrom], mapd))
}
mapd <- cal_mapd(dat$cn.ratio)
cont <- rbind(cont, c("Total",mapd))

write.table(cont, file=gsub(".data.copynumber.txt", ".mapd.txt",pathfname), sep="\t", row.names=FALSE,col.names=FALSE, quote=FALSE, append=FALSE)


cat (mapd)


